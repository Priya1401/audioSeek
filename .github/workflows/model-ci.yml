name: AudioSeek CI/CD Workflow

on:
  push:
    branches:
      - refactor-CI/CD      # only run on your testing branch
  workflow_dispatch:        # also allow manual runs from the Actions tab

jobs:
  audioseek-pipeline:
    runs-on: ubuntu-latest

    steps:
    # 1ï¸âƒ£ Pull repo
    - name: ğŸ§© Checkout repository
      uses: actions/checkout@v4

    # 2ï¸âƒ£ Set up Python
    - name: ğŸ Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: "3.10"

    # 3ï¸âƒ£ Install requirements
    - name: ğŸ“¦ Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt || echo "âš ï¸ No requirements.txt found, continuing..."

    # 4ï¸âƒ£ Run CHUNKING scripts
    - name: ğŸ§± Chunking stage
      run: |
        echo "ğŸ”¹ Running chunking pipeline..."
        python Data-Pipeline/scripts/chunking/chunking_contentPOC.py
        python Data-Pipeline/scripts/chunking/chunking_fastapi.py

    # 5ï¸âƒ£ Run TRANSCRIPTION scripts
    - name: ğŸ™ï¸ Transcription stage
      run: |
        echo "ğŸ§ Starting transcription workflow..."
        python Data-Pipeline/scripts/transcription/transcription.py
        python Data-Pipeline/scripts/transcription/transcription_tasks.py
        python Data-Pipeline/scripts/transcription/transcription_file_checks.py
        python Data-Pipeline/scripts/transcription/extraction_tasks.py
        python Data-Pipeline/scripts/transcription/summary.py

    # 6ï¸âƒ£ Run TEST scripts
    - name: ğŸ§ª Test scripts
      run: |
        echo "ğŸ§© Running test files..."
        python Data-Pipeline/scripts/tests/test_transcription.py
        python Data-Pipeline/scripts/tests/test_transcription_tasks.py
        python Data-Pipeline/scripts/tests/test_summary.py

    # 7ï¸âƒ£ Run VALIDATION scripts
    - name: âš™ï¸ Validation stage
      run: |
        echo "ğŸ” Running validation checks..."
        python Data-Pipeline/scripts/validation/conftest.py

    # 8ï¸âƒ£ Upload logs or metrics
    - name: ğŸ“Š Upload artifacts
      uses: actions/upload-artifact@v4
      with:
        name: pipeline-logs
        path: Data-Pipeline/logs/
        if-no-files-found: warn

    # 9ï¸âƒ£ Finish
    - name: ğŸ‰ Done
      run: echo "âœ… AudioSeek CI/CD pipeline executed successfully!"
